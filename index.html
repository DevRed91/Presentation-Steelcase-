<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="https://fonts.googleapis.com/css?family=Montserrat|Raleway&display=swap" rel="stylesheet">
        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/gltf_validator.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="babylon.glTF2FileLoader.js"></script>
        <script src="babylon.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }

        </style>
    </head>
<body>
    <canvas id="renderCanvas">

    </canvas>

    <script>
        var canvas = document.querySelector("#renderCanvas");

        var createScene = function () {

        // Create the scene space
        var scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3.FromHexString("#e5e5e5");

        // Add a camera to the scene and attach it to the canvas
        var camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, -Math.PI / 2, 100, BABYLON.Vector3(1,0,1), scene);
            camera.attachControl(canvas, true);
            // camera.setPosition(new BABYLON.Vector3(-5 ,15, -5));
            camera.lowerRadiusLimit = 5;
            camera.upperRadiusLimit = 5;
            camera.useFramingBehavior = true;

        //adding lights
        var light1 = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 100, 0), scene);

        //Adding button to add walls
        var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

        var selectedMesh;

        var clicks = 0;

        //click mesh to highlight
        var makeOverOut = function (mesh) {
            mesh.actionManager = new BABYLON.ActionManager(scene);
            mesh.actionManager.registerAction(
                new BABYLON.SetValueAction(
                    BABYLON.ActionManager.OnPointerOutTrigger, 
                    mesh.material, 
                    "emissiveColor", 
                    mesh.material.emissiveColor
                ));
            mesh.actionManager.registerAction(
                new BABYLON.SetValueAction(
                    BABYLON.ActionManager.OnPickTrigger, 
                    mesh.material, 
                    "emissiveColor", 
                    BABYLON.Color3.Yellow()
                ));
        }

        //click to show mesh
        var clickToShow = function (mesh){
            mesh.actionManager = new BABYLON.ActionManager(scene);
            mesh.actionManager
           .registerAction(
               new BABYLON.InterpolateValueAction(
                   BABYLON.ActionManager.OnPickTrigger,
                   mesh.material,
                    "alpha",
                    0.5,

               )
           )
           .then(
               new BABYLON.InterpolateValueAction(
                   BABYLON.ActionManager.OnPickTrigger,
                   mesh.material,
                   "alpha",
                    0,

                )

           );
        }

        //color of mesh
        var meshColor = function (meshMat, color, num){
            meshMat.diffuseColor = new BABYLON.Color3.FromHexString(color);
            meshMat.specularColor = new BABYLON.Color3.Black();
            meshMat.alpha = num;
        }

        //button properties with image
        var buttonPropImage = function (button, left, top){
            button.width = "50px";
            button.height = "50px";
            button.color = "black";
            button.background = "#e5e5e5";
            button.left = left;
            button.top = top;
            button.cornerRadius = 5;
        };

        //button properties with text
        var buttonPropText = function (button, left, top){
            button.width = "90px";
            button.height = "40px";
            button.color = "black";
            button.background = "#e5e5e5";
            button.left = left;
            button.top = top;
            button.cornerRadius = 5;
        };

        //button color change on hover
        var buttonColorChange = function (button){
            button.onPointerEnterObservable.add(function() {
                button.background = "grey";
            });
            button.onPointerOutObservable.add(function() {
                button.background = "#e5e5e5";
            });
        }
        

        //office model
        var wall, wall2, floor, glassWall1, glassWall2, glassWall3;

        //floor material
        var floorMaterial = new BABYLON.StandardMaterial("floor material", scene);
            meshColor(floorMaterial, "#FFFFFF", 1);

        //wall material
        var wallMaterial = new BABYLON.StandardMaterial("wall material", scene);
            meshColor(wallMaterial, "#D4E6F1", 1);

        //exterior glass wall material
        var glassMaterialExt = new BABYLON.StandardMaterial("glass wall material", scene);
            meshColor(glassMaterialExt, "#C0C0C0", 0.25);
        
        //desk properties
        var desk1, desk2;

        BABYLON.SceneLoader.ImportMesh(null,"./","gltf/Steelcase/workspace.glb",scene,function (plan) {
            floor = plan[0].getChildMeshes()[1];
            floor.material = floorMaterial;

            glassWall1 = plan[0].getChildMeshes()[0];
            glassWall1.material = glassMaterialExt;

        });

        //table top material
        var tableTopMaterial = new BABYLON.StandardMaterial("tabel top material", scene);
            meshColor(tableTopMaterial, "#FFE7C7", 1);
        //import desk
        BABYLON.SceneLoader.ImportMesh(null,"./","gltf/Steelcase/desk2.glb",scene,function (desk) {
            desk1 = desk[0].getChildMeshes()[0];
            desk1.material = tableTopMaterial;

            desk2 = desk[0].getChildMeshes()[1];
            desk2.material = tableTopMaterial;

        });

        //chair material
        var chair;
        var chairMaterial = new BABYLON.StandardMaterial("chair material", scene);
            meshColor(chairMaterial, "#808080", 1);
        
        //importing chairs in part
        BABYLON.SceneLoader.ImportMesh(null,"./","gltf/Steelcase/chair2.glb",scene,function (chair) {
        });

        BABYLON.SceneLoader.ImportMesh(null,"./","gltf/Steelcase/chair.glb",scene,function (chair) {
        });

        // Button for Plan
        var butPlan = BABYLON.GUI.Button.CreateSimpleButton("butPlan", "Top View");

            buttonPropText(butPlan, "42%", "-40%");            
            //color change on hover
            buttonColorChange(butPlan);

            var showPlan = 0;
            butPlan.onPointerClickObservable.add(function(){
                showPlan++;
                if (showPlan){
                    camera.setPosition(new BABYLON.Vector3(0,10,-1));
                }
            });
            advancedTexture.addControl(butPlan);

        //Button for isometric view
        var butIso = BABYLON.GUI.Button.CreateSimpleButton("butIso", "Iso View");

            buttonPropText(butIso, "35%", "-40%");            
            //color change on hover
            buttonColorChange(butIso);

            var showIso = 0;
            butIso.onPointerClickObservable.add(function(){
                showIso++;
                if (showIso % 1 == 0){
                    camera.setPosition(new BABYLON.Vector3(-2 ,2,-2));
                }
            });

            advancedTexture.addControl(butIso);

        //DOM event
        canvas.addEventListener("click", function(e) {
          var pickResult = scene.pick(scene.pointerX, scene.pointerY);

           if(pickResult.hit) {
               if(selectedMesh == null) {
                 selectedMesh.visibility = 1.0;
                }
                selectedMesh = pickResult.pickedMesh;

                selectedMesh.visibility = 0.8;

            }
        });

        return scene;

        };
        __createScene = createScene;

        var engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true });
        var scene = createScene();

            engine.runRenderLoop(function () {
                if (scene) {
                    scene.render();
                }
            });

            // Resize
            window.addEventListener("resize", function () {
                engine.resize();
            });

    </script>
</body>
</html>
